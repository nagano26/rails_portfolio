<nav class="navbar navbar-light navbar-dark bg-dark">
  <a class="navbar-brand">お住まいの登録 </a>
</nav>

<section class="section mb-3">
  <div class="container mt-5 mb-5">
  <h2 class="title mb-5">お部屋の予約済み一覧</h2>
    <div class="row">
    <div class="count col-12 mb-3">現在の予約済み宿数：<%= @user.reservations.count %></div> 
      <% if @user.id == current_user.id %>
        <% if @user.reservations.count == 0 %>
          <div class="btn-group col-12">
            <%= link_to "宿一覧を見る", rooms_path, class: "btn btn-outline-primary mb-3 mr-3" %>
          </div>
        <% end %>
      <% end %>
      <div class="col-12">
        <% @user.reservations.each do |reservation| %>
        <table class="table table-bordered table-striped mb-5">
          <tr>
            <th>部屋名</th>
            <td><%= link_to reservation.room.room_name, room_path(reservation.room_id) %></td>
          </tr>
          <tr>
            <th>部屋の写真</th>
            <td>
              <%= link_to room_path(reservation.room_id) do %>
                <%= attachment_image_tag reservation.room, :room_image , fallback: "no-image.png",:size =>'120x120'%>
              <% end %>
            </td>
          </tr>
          <tr>
            <th>チックイン日</th>
            <td><%= reservation.start_at.to_fs(:stamp)%></td>
          </tr>
          <tr>
            <th>チックアウト日</th>
            <td><%= reservation.end_at.to_fs(:stamp) %></td>
          </tr>
          <tr>
            <th>宿泊期間</th>
            <td><%= reservation.total_day %>日</td>
          </tr>
          <tr>
            <th>一泊の宿泊料金</th>
            <td><%= reservation.room.room_price %>円</td>
          </tr>
          <tr>
            <th>人数</th>
            <td><%= reservation.number_people %>人</td>
          </tr>
          <tr>
            <th>合計金額</th>
            <td><%= reservation.total_price %>円　　(計算式：宿泊期間<%= reservation.total_day %>日　×　人数<%= reservation.number_people %>人　×　１泊の宿泊料<%= reservation.room.room_price %>円)</td>
          </tr>
          <tr>
            <th>予約確定日時</th>
            <td><%= reservation.created_at.to_fs(:stamp) %></td>
          </tr>
          <tr>
            <% if reservation.user_id == current_user.id %>
              <th>キャンセルする</th>
              <td><button type="button" class="btn btn-primary mb-12" data-toggle="modal" data-target="#testModal<%= reservation.id %>">キャンセル</button></td>
              <!-- ボタン・リンククリック後に表示される画面の内容 -->
              <div class="modal fade" id="testModal<%= reservation.id %>" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4>削除確認画面</h4>
                    </div>
                    <div class="modal-body">
                      <label>データを削除しますか？</label>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
                      <%= button_to "削除", reservation , method: :delete, class: "btn btn-outline-primary"%>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </tr>
        </table>
        <% end %>
      </div>
    </div>
  </div>
</section>